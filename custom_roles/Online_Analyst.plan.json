{
  "kpis": [
    {
      "id": "kpi_total_revenue",
      "title": "Total Revenue",
      "description": "The total revenue generated from all completed purchases.",
      "formula": "SELECT SUM(CAST(total_amount AS REAL)) FROM web_events WHERE event_type = 'purchase_completed'",
      "table": "web_events"
    },
    {
      "id": "kpi_conversion_rate",
      "title": "Session Conversion Rate",
      "description": "The percentage of unique user sessions that resulted in a completed purchase.",
      "formula": "SELECT CAST(COUNT(DISTINCT CASE WHEN event_type = 'purchase_completed' THEN session_id END) AS REAL) * 100 / COUNT(DISTINCT session_id) FROM web_events",
      "table": "web_events"
    },
    {
      "id": "kpi_average_order_value",
      "title": "Average Order Value (AOV)",
      "description": "The average revenue generated per completed purchase.",
      "formula": "SELECT AVG(CAST(total_amount AS REAL)) FROM web_events WHERE event_type = 'purchase_completed'",
      "table": "web_events"
    },
    {
      "id": "kpi_checkout_abandonment_rate",
      "title": "Checkout Abandonment Rate",
      "description": "The percentage of users who started the checkout process but did not complete the purchase.",
      "formula": "SELECT (1.0 - CAST((SELECT COUNT(*) FROM web_events WHERE event_type = 'purchase_completed') AS REAL) / (SELECT COUNT(*) FROM web_events WHERE event_type = 'begin_checkout')) * 100",
      "table": "web_events"
    },
    {
      "id": "kpi_total_sessions",
      "title": "Total Sessions",
      "description": "The total number of unique user sessions recorded.",
      "formula": "SELECT COUNT(DISTINCT session_id) FROM web_events",
      "table": "web_events"
    },
    {
      "id": "kpi_add_to_cart_rate",
      "title": "Add to Cart Rate",
      "description": "The percentage of sessions where at least one item was added to the cart.",
      "formula": "SELECT CAST(COUNT(DISTINCT CASE WHEN event_type = 'add_to_cart' THEN session_id END) AS REAL) * 100 / COUNT(DISTINCT session_id) FROM web_events",
      "table": "web_events"
    }
  ],
  "charts": [
    {
      "id": "chart_monthly_revenue_trend",
      "title": "Monthly Revenue Trend",
      "type": "line",
      "description": "Shows the total revenue generated from completed purchases, aggregated by month.",
      "query_sql": "SELECT STRFTIME('%Y-%m', timestamp) as month, SUM(CAST(total_amount AS REAL)) as revenue FROM web_events WHERE event_type = 'purchase_completed' GROUP BY 1 ORDER BY 1"
    },
    {
      "id": "chart_user_conversion_funnel",
      "title": "User Conversion Funnel",
      "type": "bar",
      "description": "Displays the number of unique sessions at key stages of the customer journey, from viewing a page to completing a purchase.",
      "query_sql": "SELECT '1. Page View' AS step, COUNT(DISTINCT session_id) AS session_count FROM web_events WHERE event_type = 'page_view' UNION ALL SELECT '2. Product View' AS step, COUNT(DISTINCT session_id) AS session_count FROM web_events WHERE event_type = 'product_view' UNION ALL SELECT '3. Add to Cart' AS step, COUNT(DISTINCT session_id) AS session_count FROM web_events WHERE event_type = 'add_to_cart' UNION ALL SELECT '4. Begin Checkout' AS step, COUNT(DISTINCT session_id) AS session_count FROM web_events WHERE event_type = 'begin_checkout' UNION ALL SELECT '5. Purchase' AS step, COUNT(DISTINCT session_id) AS session_count FROM web_events WHERE event_type = 'purchase_completed' ORDER BY step"
    },
    {
      "id": "chart_event_distribution_by_platform",
      "title": "Event Distribution by Platform",
      "type": "bar",
      "description": "Compares the volume of different event types between Web and App platforms.",
      "query_sql": "SELECT platform, event_type, COUNT(event_id) AS event_count FROM web_events GROUP BY 1, 2 ORDER BY 1, 3 DESC"
    },
    {
      "id": "top_10_products_added_to_cart",
      "title": "Make this into a relevant chart",
      "type": "table",
      "query_sql": "SELECT event_type, COUNT(*) AS event_count FROM web_events GROUP BY event_type ORDER BY event_count DESC"
    },
    {
      "id": "show_me_top_five_search_terms_in_a_bar_chart",
      "title": "Show me top five search terms in a bar chart",
      "type": "bar",
      "query_sql": "SELECT search_term, COUNT(*) AS search_count FROM web_events WHERE event_type = 'search' AND search_term IS NOT NULL GROUP BY search_term ORDER BY search_count DESC LIMIT 5"
    }
  ],
  "insights": [
    "There is a significant drop-off between 'add_to_cart' (4,067 events) and 'begin_checkout' (1,850 events), suggesting potential friction or distractions on the cart page that prevent users from proceeding.",
    "The checkout abandonment rate is high, with only 692 purchases resulting from 1,850 checkout initiations. This indicates issues with the checkout process, such as complexity, unexpected costs, or a lack of payment options.",
    "User activity is almost evenly split between Web (28,005 events) and App (21,995 events) platforms, highlighting the need for a consistent user experience and feature parity across both channels.",
    "Desktop web users generate the most events (17,262), but there is substantial traffic from mobile web, iOS, and Android apps. It is crucial to analyze conversion rates and user behavior separately for each device type to optimize performance.",
    "A small number of customers are highly active (e.g., 'CUST-00083' with 142 events), indicating an opportunity to cultivate loyalty and increase lifetime value through targeted campaigns or VIP programs.",
    "The 'page_view' event count (22,552) is significantly higher than 'product_view' (7,295), which could suggest that users are having difficulty discovering relevant products from category or homepage views."
  ]
}