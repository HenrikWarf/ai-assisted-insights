{
  "kpis": [
    {
      "id": "total_ytd_sales_ty",
      "title": "Total YTD Sales (This Year)",
      "description": "The total sales from the beginning of the year to the current date for this year.",
      "formula": "SELECT SUM(\"YTD_This_Year_Sales\") FROM \"pa_sales\"",
      "table": "pa_sales"
    },
    {
      "id": "ytd_sales_growth_percent",
      "title": "YTD Sales Growth (%)",
      "description": "The percentage growth in year-to-date sales compared to the same period last year.",
      "formula": "SELECT (SUM(\"YTD_This_Year_Sales\") - SUM(\"YTD_Last_Year_Sales\")) * 100.0 / SUM(\"YTD_Last_Year_Sales\") FROM \"pa_sales\"",
      "table": "pa_sales"
    },
    {
      "id": "total_ytd_gross_profit",
      "title": "Total YTD Gross Profit",
      "description": "The total gross profit from the beginning of the year to the current date for this year.",
      "formula": "SELECT SUM(\"YTD_Gross_Profit\") FROM \"pa_sales\"",
      "table": "pa_sales"
    },
    {
      "id": "ytd_gross_profit_margin_percent",
      "title": "YTD Gross Profit Margin (%)",
      "description": "The year-to-date gross profit as a percentage of total year-to-date sales for this year.",
      "formula": "SELECT SUM(\"YTD_Gross_Profit\") * 100.0 / SUM(\"YTD_This_Year_Sales\") FROM \"pa_sales\"",
      "table": "pa_sales"
    },
    {
      "id": "total_ytd_quantity_sold_ty",
      "title": "Total YTD Quantity Sold (This Year)",
      "description": "The total number of units sold from the beginning of the year to the current date for this year.",
      "formula": "SELECT SUM(\"YTD_This_Year_Qty\") FROM \"pa_sales\"",
      "table": "pa_sales"
    },
    {
      "id": "ytd_quantity_growth_percent",
      "title": "YTD Quantity Growth (%)",
      "description": "The percentage growth in year-to-date quantity sold compared to the same period last year.",
      "formula": "SELECT (SUM(\"YTD_This_Year_Qty\") - SUM(\"YTD_Last_Year_Qty\")) * 100.0 / SUM(\"YTD_Last_Year_Qty\") FROM \"pa_sales\"",
      "table": "pa_sales"
    },
    {
      "id": "ytd_average_selling_price_ty",
      "title": "YTD Average Selling Price (This Year)",
      "description": "The average price at which products were sold year-to-date for this year (Total YTD Sales / Total YTD Quantity).",
      "formula": "SELECT SUM(\"YTD_This_Year_Sales\") / SUM(\"YTD_This_Year_Qty\") FROM \"pa_sales\"",
      "table": "pa_sales"
    },
    {
      "id": "total_rolling_4w_sales_ty",
      "title": "Rolling 4-Week Sales (This Year)",
      "description": "The total sales over the last four weeks for this year.",
      "formula": "SELECT SUM(\"Rolling_4w_This_Year_Sales\") FROM \"pa_sales\"",
      "table": "pa_sales"
    },
    {
      "id": "rolling_4w_sales_growth_percent",
      "title": "Rolling 4-Week Sales Growth (%)",
      "description": "The percentage growth in sales over the last four weeks compared to the same four-week period last year.",
      "formula": "SELECT (SUM(\"Rolling_4w_This_Year_Sales\") - SUM(\"Rolling_4w_Last_Year_Sales\")) * 100.0 / SUM(\"Rolling_4w_Last_Year_Sales\") FROM \"pa_sales\"",
      "table": "pa_sales"
    },
    {
      "id": "rolling_4w_gross_profit_margin",
      "title": "Rolling 4-Week Gross Profit Margin (%)",
      "description": "The gross profit as a percentage of sales over the last four weeks for this year.",
      "formula": "SELECT SUM(\"Rolling_4w_Gross_Profit\") * 100.0 / SUM(\"Rolling_4w_This_Year_Sales\") FROM \"pa_sales\"",
      "table": "pa_sales"
    },
    {
      "id": "total_last_week_sales_ty",
      "title": "Last Week Sales (This Year)",
      "description": "The total sales in the last week for this year.",
      "formula": "SELECT SUM(\"Last_Week_This_Year_Sales\") FROM \"pa_sales\"",
      "table": "pa_sales"
    },
    {
      "id": "last_week_sales_growth_percent",
      "title": "Last Week Sales Growth (%)",
      "description": "The percentage growth in sales in the last week compared to the same week last year.",
      "formula": "SELECT (SUM(\"Last_Week_This_Year_Sales\") - SUM(\"Last_Week_Last_Year_Sales\")) * 100.0 / SUM(\"Last_Week_Last_Year_Sales\") FROM \"pa_sales\"",
      "table": "pa_sales"
    },
    {
      "id": "last_week_gross_profit",
      "title": "Last Week Gross Profit",
      "description": "The total gross profit generated in the last week for this year.",
      "formula": "SELECT SUM(\"Last_Week_This_Year_Gross_Profit\") FROM \"pa_sales\"",
      "table": "pa_sales"
    },
    {
      "id": "number_of_product_areas",
      "title": "Number of Product Areas",
      "description": "The total count of distinct product areas.",
      "formula": "SELECT COUNT(DISTINCT \"Product_Area_Name\") FROM \"pa_sales\"",
      "table": "pa_sales"
    },
    {
      "id": "number_of_markets",
      "title": "Number of Markets",
      "description": "The total count of distinct primary market areas.",
      "formula": "SELECT COUNT(DISTINCT \"Primary_Market_Area_Name\") FROM \"pa_sales\"",
      "table": "pa_sales"
    }
  ],
  "charts": [
    {
      "id": "1",
      "title": "Detroit Market: Weekly Revenue Comparison vs Last Year",
      "description": "Compare revenue in the detroit market to last years",
      "type": "bar",
      "query_sql": "SELECT week_start_date, SUM(Last_Week_This_Year_Sales) AS \"This Year\", SUM(Last_Week_Last_Year_Sales) AS \"Last Year\" FROM pa_sales WHERE Primary_Market_Area_Name LIKE '%Detroit%' GROUP BY week_start_date ORDER BY week_start_date",
      "ai_reasoning": "I have modified the existing query to filter the sales data specifically for the Detroit market, as requested. The query uses a WHERE clause on the 'Primary_Market_Area_Name' column. The bar chart format is retained to effectively compare this year's weekly sales against last year's for the specified market. The title has been updated to clearly reflect the new context."
    },
    {
      "id": "2",
      "title": "Weekly Sales Trend: This Year vs Last Year",
      "description": "Shows the trend of total sales for the last week of this year compared to the same week last year, plotted over time by week start date.",
      "type": "line",
      "query_sql": "SELECT \"week_start_date\", SUM(\"Last_Week_This_Year_Sales\") AS \"Last Week Sales TY\", SUM(\"Last_Week_Last_Year_Sales\") AS \"Last Week Sales LY\" FROM \"pa_sales\" GROUP BY \"week_start_date\" ORDER BY \"week_start_date\" ASC;"
    },
    {
      "id": "3",
      "title": "YTD Sales Contribution by Product Area",
      "description": "Illustrates the proportion of total Year-to-Date sales contributed by each Product Area, showing which product categories are the biggest revenue drivers.",
      "type": "pie",
      "query_sql": "SELECT \"Product_Area_Name\", SUM(\"YTD_This_Year_Sales\") AS \"Total YTD Sales\" FROM \"pa_sales\" GROUP BY \"Product_Area_Name\" HAVING SUM(\"YTD_This_Year_Sales\") > 0;"
    },
    {
      "id": "4",
      "title": "Top 10 HFB by YTD Gross Profit",
      "description": "Ranks the top 10 Home Furnishing Businesses (HFB) based on their total Year-to-Date gross profit, highlighting the most profitable business units.",
      "type": "bar",
      "query_sql": "SELECT \"HFB_Name\", SUM(\"YTD_Gross_Profit\") AS \"Total YTD Gross Profit\" FROM \"pa_sales\" GROUP BY \"HFB_Name\" ORDER BY \"Total YTD Gross Profit\" DESC LIMIT 10;"
    },
    {
      "id": "5",
      "title": "Rolling 4-Week Sales Trend vs Last Year",
      "description": "Tracks the 4-week rolling average of sales for this year and last year. This smooths out weekly volatility and provides a clearer view of recent sales trends.",
      "type": "line",
      "query_sql": "SELECT \"week_start_date\", SUM(\"Rolling_4w_This_Year_Sales\") AS \"Rolling 4w Sales TY\", SUM(\"Rolling_4w_Last_Year_Sales\") AS \"Rolling 4w Sales LY\" FROM \"pa_sales\" GROUP BY \"week_start_date\" ORDER BY \"week_start_date\" ASC;"
    },
    {
      "id": "6",
      "title": "YTD Quantity vs Sales Growth by Product Area",
      "description": "Compares the year-over-year percentage change in YTD quantity sold versus the percentage change in YTD sales for each product area. This helps to understand if sales growth is driven by volume or price increases.",
      "type": "bar",
      "query_sql": "SELECT \"Product_Area_Name\", (SUM(\"YTD_This_Year_Qty\") - SUM(\"YTD_Last_Year_Qty\")) * 100.0 / SUM(\"YTD_Last_Year_Qty\") AS \"YoY_Qty_Growth_Percent\", (SUM(\"YTD_This_Year_Sales\") - SUM(\"YTD_Last_Year_Sales\")) * 100.0 / SUM(\"YTD_Last_Year_Sales\") AS \"YoY_Sales_Growth_Percent\" FROM \"pa_sales\" WHERE \"YTD_Last_Year_Qty\" > 0 AND \"YTD_Last_Year_Sales\" > 0 GROUP BY \"Product_Area_Name\" ORDER BY \"YoY_Sales_Growth_Percent\" DESC;"
    },
    {
      "id": "7",
      "title": "Last Week's Performance Dashboard",
      "description": "A detailed table summarizing key performance indicators for the last week, including sales, comparison to last year, quantity, and gross profit, grouped by market and HFB.",
      "type": "table",
      "query_sql": "SELECT \"Primary_Market_Area_Name\", \"HFB_Name\", SUM(\"Last_Week_This_Year_Sales\") AS \"LW Sales TY\", SUM(\"Last_Week_Last_Year_Sales\") AS \"LW Sales LY\", SUM(\"Last_Week_This_Year_Qty\") AS \"LW Qty TY\", SUM(\"Last_Week_This_Year_Gross_Profit\") AS \"LW Gross Profit\" FROM \"pa_sales\" GROUP BY \"Primary_Market_Area_Name\", \"HFB_Name\" ORDER BY \"LW Sales TY\" DESC;"
    },
    {
      "id": "8",
      "title": "YTD Profitability by Market Area",
      "description": "Displays the total Year-to-Date sales alongside the total Year-to-Date gross profit for each Primary Market Area, identifying which high-selling markets are also the most profitable.",
      "type": "bar",
      "query_sql": "SELECT \"Primary_Market_Area_Name\", SUM(\"YTD_This_Year_Sales\") AS \"YTD Sales\", SUM(\"YTD_Gross_Profit\") AS \"YTD Gross Profit\" FROM \"pa_sales\" GROUP BY \"Primary_Market_Area_Name\" ORDER BY \"YTD Sales\" DESC;"
    }
  ],
  "insights": [
    "Sales Transactions",
    "Product Performance",
    "Customer Purchasing Behavior",
    "Store Performance",
    "Pricing and Discounting"
  ]
}