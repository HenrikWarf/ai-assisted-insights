{
  "kpis": [
    {
      "id": "kpi_total_customers",
      "title": "Total Unique Customers",
      "description": "The total count of unique customers in the database.",
      "formula": "SELECT COUNT(DISTINCT customer_id) FROM customers",
      "table": "customers"
    },
    {
      "id": "kpi_avg_ltv",
      "title": "Average Customer Lifetime Value (LTV)",
      "description": "The average total revenue generated per customer over their entire relationship with the company.",
      "formula": "SELECT AVG(CAST(total_spent_ltv AS REAL)) FROM customers",
      "table": "customers"
    },
    {
      "id": "kpi_avg_aov",
      "title": "Average Order Value (AOV)",
      "description": "The average amount spent each time a customer places an order.",
      "formula": "SELECT AVG(CAST(average_order_value AS REAL)) FROM customers",
      "table": "customers"
    },
    {
      "id": "kpi_repeat_purchase_rate",
      "title": "Repeat Purchase Rate",
      "description": "The percentage of customers who have made more than one purchase.",
      "formula": "SELECT (CAST(SUM(CASE WHEN CAST(total_number_of_orders AS INTEGER) > 1 THEN 1 ELSE 0 END) AS REAL) * 100) / COUNT(DISTINCT customer_id) FROM customers",
      "table": "customers"
    },
    {
      "id": "kpi_avg_conversion_time_days",
      "title": "Avg. Time to First Purchase (Days)",
      "description": "The average number of days between a customer's registration and their first purchase.",
      "formula": "SELECT AVG(JULIANDAY(first_purchase_date) - JULIANDAY(registration_date)) FROM customers WHERE first_purchase_date IS NOT NULL AND registration_date IS NOT NULL",
      "table": "customers"
    },
    {
      "id": "kpi_avg_return_rate",
      "title": "Average Return Rate",
      "description": "The average percentage of items returned by customers.",
      "formula": "SELECT AVG(CAST(return_rate_percent AS REAL)) FROM customers",
      "table": "customers"
    }
  ],
  "charts": [
    {
      "id": "chart_monthly_acquisitions",
      "title": "New Customer Registrations Over Time",
      "type": "line",
      "description": "Shows the trend of new customer sign-ups by month and year, indicating business growth and seasonality.",
      "query_sql": "SELECT STRFTIME('%Y-%m', registration_date) AS registration_month, COUNT(DISTINCT customer_id) AS new_customers FROM customers WHERE registration_date IS NOT NULL GROUP BY 1 ORDER BY 1 ASC"
    },
    {
      "id": "chart_ltv_by_acquisition_source",
      "title": "Average LTV by Acquisition Source",
      "type": "bar",
      "description": "Compares the average lifetime value of customers acquired through different marketing channels to evaluate channel profitability.",
      "query_sql": "SELECT acquisition_source, AVG(CAST(total_spent_ltv AS REAL)) AS average_ltv FROM customers GROUP BY acquisition_source ORDER BY average_ltv DESC"
    },
    {
      "id": "chart_age_distribution",
      "title": "Customer Age Distribution",
      "type": "bar",
      "description": "Visualizes the distribution of customers across different age groups, highlighting the core age demographic.",
      "query_sql": "SELECT CASE WHEN CAST(age AS INTEGER) BETWEEN 14 AND 17 THEN '14-17' WHEN CAST(age AS INTEGER) BETWEEN 18 AND 24 THEN '18-24' WHEN CAST(age AS INTEGER) BETWEEN 25 AND 34 THEN '25-34' WHEN CAST(age AS INTEGER) >= 35 THEN '35+' ELSE 'Unknown' END AS age_group, COUNT(DISTINCT customer_id) AS customer_count FROM customers GROUP BY age_group ORDER BY age_group"
    },
    {
      "id": "chart_aov_by_discount_affinity",
      "title": "Average Order Value by Discount Affinity",
      "type": "bar",
      "description": "Compares the Average Order Value (AOV) for customers with different levels of discount affinity to understand the impact of discounts on spending behavior.",
      "query_sql": "SELECT discount_affinity, AVG(CAST(average_order_value AS REAL)) AS avg_aov FROM customers GROUP BY discount_affinity ORDER BY avg_aov DESC"
    },
    {
      "id": "chart_customer_segment_by_location_gender",
      "title": "Customer Segments by Location and Gender",
      "type": "table",
      "description": "A table breaking down the customer base by location and gender, providing a clear view of key demographic segments.",
      "query_sql": "SELECT location, gender, COUNT(DISTINCT customer_id) as customer_count, ROUND(AVG(CAST(total_spent_ltv AS REAL)), 2) as avg_ltv FROM customers GROUP BY location, gender ORDER BY location, customer_count DESC"
    },
    {
      "id": "chart_top_preferred_categories",
      "title": "Top Preferred Product Categories",
      "type": "bar",
      "description": "Identifies the most popular product categories among customers. This query splits comma-separated values to count each category individually.",
      "query_sql": "WITH RECURSIVE split(s, part, rest) AS ( SELECT customer_id, '', preferred_categories || ',' FROM customers UNION ALL SELECT s, SUBSTR(rest, 1, INSTR(rest, ',') - 1), SUBSTR(rest, INSTR(rest, ',') + 1) FROM split WHERE rest != '' ) SELECT LTRIM(part) as category, COUNT(*) as customer_preference_count FROM split WHERE part != '' GROUP BY 1 ORDER BY 2 DESC LIMIT 10"
    }
  ],
  "insights": [
    "The customer base is heavily dominated by a young (18-24), urban, female demographic, suggesting that marketing and product strategies should be highly tailored to this core audience.",
    "Paid Social and Organic Search are the primary acquisition channels, creating a dependency. Diversifying by investing in lower-volume but higher-LTV channels like Direct and Referral could mitigate risk and improve profitability.",
    "A significant portion of customers are 'One-time' purchasers. This represents a major opportunity to increase LTV by implementing targeted retention campaigns, such as post-purchase follow-ups or second-order incentives.",
    "Customers with 'High' discount affinity do not necessarily have a higher Average Order Value, indicating that discount strategies may be driving transactions but not increasing basket size.",
    "The data quality requires attention; all fields are stored as TEXT, requiring frequent casting for calculations, and duplicate customer_ids exist in the raw data, necessitating the use of DISTINCT in aggregations.",
    "There is a notable mismatch between acquisition volume and value. 'Direct' traffic yields the highest LTV customers but is only the 5th largest channel by volume, indicating a significant opportunity to grow brand marketing to attract more of these high-value users."
  ]
}