{
  "kpis": [
    {
      "id": "kpi_total_customers",
      "title": "Total Customers",
      "description": "The total number of unique customers in the database.",
      "formula": "SELECT COUNT(DISTINCT customer_id) FROM customers",
      "table": "customers"
    },
    {
      "id": "kpi_avg_ltv",
      "title": "Average Customer Lifetime Value (LTV)",
      "description": "The average total revenue generated from a customer over their entire relationship with the company.",
      "formula": "SELECT AVG(CAST(total_spent_ltv AS REAL)) FROM customers",
      "table": "customers"
    },
    {
      "id": "kpi_avg_aov",
      "title": "Average Order Value (AOV)",
      "description": "The average amount a customer spends per order.",
      "formula": "SELECT AVG(CAST(average_order_value AS REAL)) FROM customers",
      "table": "customers"
    },
    {
      "id": "kpi_avg_return_rate",
      "title": "Average Return Rate",
      "description": "The average percentage of items returned by customers.",
      "formula": "SELECT AVG(CAST(return_rate_percent AS REAL)) FROM customers",
      "table": "customers"
    },
    {
      "id": "kpi_avg_time_to_first_purchase",
      "title": "Avg. Time to First Purchase (Days)",
      "description": "The average number of days between a customer's registration and their first purchase, indicating activation speed.",
      "formula": "SELECT AVG(JULIANDAY(first_purchase_date) - JULIANDAY(registration_date)) FROM customers",
      "table": "customers"
    }
  ],
  "charts": [
    {
      "id": "chart_quarterly_customer_acquisitions",
      "title": "Quarterly Customer Acquisitions by Source",
      "type": "bar",
      "description": "A breakdown of new customer registrations each quarter by their acquisition source. This helps in understanding the performance of different marketing channels over time on a quarterly basis.",
      "query_sql": "SELECT STRFTIME('%Y', registration_date) || '-Q' || ((CAST(STRFTIME('%m', registration_date) AS INTEGER) + 2) / 3) AS registration_quarter, acquisition_source, COUNT(customer_id) AS new_customers FROM customers WHERE registration_date IS NOT NULL AND acquisition_source IS NOT NULL GROUP BY 1, 2 ORDER BY 1 ASC, 3 DESC;"
    },
    {
      "id": "chart_ltv_by_acquisition_source",
      "title": "Average LTV by Acquisition Source",
      "type": "bar",
      "description": "Compares the average lifetime value (LTV) of customers acquired through different marketing channels.",
      "query_sql": "SELECT acquisition_source, AVG(CAST(total_spent_ltv AS REAL)) AS average_ltv FROM customers GROUP BY acquisition_source ORDER BY average_ltv DESC;"
    },
    {
      "id": "chart_age_distribution",
      "title": "Customer Age Distribution",
      "type": "bar",
      "description": "Shows the number of customers in different age brackets, highlighting the dominant age groups.",
      "query_sql": "SELECT CASE WHEN CAST(age AS INTEGER) BETWEEN 14 AND 17 THEN '14-17' WHEN CAST(age AS INTEGER) BETWEEN 18 AND 24 THEN '18-24' WHEN CAST(age AS INTEGER) BETWEEN 25 AND 34 THEN '25-34' WHEN CAST(age AS INTEGER) BETWEEN 35 AND 44 THEN '35-44' ELSE '45+' END AS age_group, COUNT(customer_id) AS number_of_customers FROM customers GROUP BY age_group ORDER BY age_group;"
    },
    {
      "id": "chart_customer_recency",
      "title": "Customer Recency Segments",
      "type": "pie",
      "description": "Segments customers based on when they last made a purchase, identifying active, at-risk, and churned customers. (Based on a reference date of 2025-04-10).",
      "query_sql": "SELECT CASE WHEN JULIANDAY('2025-04-10') - JULIANDAY(date_of_last_purchase) <= 30 THEN 'Active (0-30 Days)' WHEN JULIANDAY('2025-04-10') - JULIANDAY(date_of_last_purchase) <= 90 THEN 'At Risk (31-90 Days)' WHEN JULIANDAY('2025-04-10') - JULIANDAY(date_of_last_purchase) <= 180 THEN 'Lapsing (91-180 Days)' ELSE 'Churned (181+ Days)' END AS recency_segment, COUNT(customer_id) AS customer_count FROM customers GROUP BY recency_segment ORDER BY 1;"
    },
    {
      "id": "chart_high_value_customer_profile",
      "title": "Average Order Value: High-Value vs. Low-Value Customers",
      "type": "bar",
      "description": "Compares the average order value (AOV) between the top 25% of customers by LTV (High-Value) and the bottom 25% (Low-Value).",
      "query_sql": "WITH CustomerTiers AS ( SELECT customer_id, NTILE(4) OVER (ORDER BY CAST(total_spent_ltv AS REAL) DESC) as ltv_quartile FROM customers ) SELECT CASE WHEN T1.ltv_quartile = 1 THEN 'High-Value (Top 25%)' ELSE 'Low-Value (Bottom 25%)' END AS customer_segment, ROUND(AVG(CAST(T2.average_order_value AS REAL)), 2) AS average_order_value FROM CustomerTiers T1 JOIN customers T2 ON T1.customer_id = T2.customer_id WHERE T1.ltv_quartile = 1 OR T1.ltv_quartile = 4 GROUP BY customer_segment ORDER BY average_order_value DESC;",
      "chart_reasoning": "The user explicitly requested to 'Show this in a bar chart'. This edit transforms the existing table, which displays multiple metrics, into a bar chart focused on a single, impactful comparison. Average Order Value was chosen as the metric for visualization because it's a key differentiator between high-value and low-value customers and is well-suited for comparison in a bar chart format."
    },
    {
      "id": "chart_customer_location_distribution",
      "title": "Customer Distribution by Location",
      "type": "pie",
      "description": "This pie chart shows the proportion of customers from each location, illustrating the geographic breakdown of the customer base.",
      "query_sql": "SELECT location, COUNT(customer_id) AS number_of_customers FROM customers WHERE location IS NOT NULL GROUP BY location ORDER BY number_of_customers DESC;",
      "chart_reasoning": "The user explicitly requested to 'change plot into a pie chart'. Although the chart was already a pie chart, this edit confirms the user's desire for this visualization type. A pie chart is an effective way to display the proportional distribution of a categorical variable like customer location."
    },
    {
      "id": "chart_acquisition_source_distribution",
      "title": "Customer Acquisition Source Distribution",
      "description": "This chart displays the distribution of customers by their acquisition source, showing which channels are most effective in bringing in new customers.",
      "type": "pie",
      "query_sql": "SELECT acquisition_source, COUNT(customer_id) AS number_of_customers FROM customers GROUP BY acquisition_source ORDER BY number_of_customers DESC;"
    },
    {
      "id": "chart-aov-by-gender-90123",
      "title": "Average Order Value by Gender",
      "description": "This chart displays the average of all customers' average order values, grouped by gender. It helps in understanding the spending behavior of different gender segments.",
      "type": "bar",
      "query_sql": "SELECT gender, AVG(CAST(average_order_value AS REAL)) AS \"Average Order Value\" FROM customers WHERE gender IS NOT NULL AND gender != '' GROUP BY gender;"
    }
  ],
  "insights": [
    "The customer base is predominantly young (18-24), female, and resides in urban areas, suggesting marketing and product selection should be tailored to this demographic.",
    "Paid Social and Organic Search are the top acquisition channels by volume, but 'Referral' and 'Email Marketing' bring in customers with a significantly higher Average Lifetime Value (LTV), indicating these channels attract more loyal customers.",
    "A large portion of the customer base made their last purchase over 90 days ago, presenting an opportunity for targeted re-engagement and reactivation campaigns to prevent churn.",
    "High-value customers (top 25% by LTV) place more orders and have a higher Average Order Value (AOV) but also exhibit a slightly higher return rate compared to low-value customers.",
    "There is an opportunity to improve customer activation, as it takes an average of several weeks for a new registrant to make their first purchase. A targeted welcome email series or a first-purchase incentive could shorten this period."
  ]
}